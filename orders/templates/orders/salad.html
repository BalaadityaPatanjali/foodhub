{% extends 'orders/header.html' %}
{% load static %}

{% block content %}
<!-- Fixed Salad Page with Working Cart (Following Pasta Pattern) -->
<div class="salad-page" style="padding-top: 100px; min-height: 100vh; background: #f8fafc;">
    <!-- Hero Section -->
    <section class="hero" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; text-align: center; padding: 4rem 2rem; margin-bottom: 3rem;">
        <h1 style="font-size: 3rem; margin-bottom: 1rem; font-weight: 700;">ðŸ¥— Choose Your Fresh Salad ðŸ¥—</h1>
        <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.9;">Farm-fresh ingredients, crisp greens, and delicious dressings made daily</p>
    </section>

    <!-- Main Content -->
    <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 3rem 2rem;">
        <h2 style="text-align: center; font-size: 2.5rem; color: #333; margin-bottom: 3rem; font-weight: 700;">Salad Menu</h2>

        <div class="salad-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin-top: 2rem;">
            {% for dish in dishes %}
            <div class="salad-card" style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); transition: all 0.3s ease; position: relative;">
                <div class="salad-image" style="width: 100%; height: 200px; background: linear-gradient(45deg, #34d399 0%, #10b981 50%, #059669 100%); position: relative; overflow: hidden;">
                    {% if dish.dish_name == "Garden Salad" %}
    <img src="https://www.recipetineats.com/tachyon/2021/08/Garden-Salad_48.jpg?resize=900%2C1260&zoom=0.72g"
         alt="{{ dish.dish_name }}" style="width: 100%; height: 100%; object-fit: cover;">
{% elif dish.dish_name == "Greek Salad" %}
    <img src="https://cdn.loveandlemons.com/wp-content/uploads/2019/07/greek-salad-2-786x1024.jpg"
         alt="{{ dish.dish_name }}" style="width: 100%; height: 100%; object-fit: cover;">
{% elif dish.dish_name == "Antipasto" %}
    <img src="https://www.allrecipes.com/thmb/UaZFB-KV0e6Aqr9iyUSYhOxXDCE=/750x0/filters:no_upscale():max_bytes(150000):strip_icc():format(webp)/3895858-e2a9a89c5abd4ca3b9db096e6345cd39.jpg"
         alt="{{ dish.dish_name }}" style="width: 100%; height: 100%; object-fit: cover;">
{% elif dish.dish_name == "Tuna Salad" %}
    <img src="https://i2.wp.com/www.downshiftology.com/wp-content/uploads/2020/04/Tuna-Salad-6-1024x1536.jpg"
         alt="{{ dish.dish_name }}" style="width: 100%; height: 100%; object-fit: cover;">
{% else %}
    <img src="https://cdn.pixabay.com/photo/2016/03/05/19/02/salad-1239147_1280.jpg"
         alt="{{ dish.dish_name }}" style="width: 100%; height: 100%; object-fit: cover;">
{% endif %}
                    <div style="position: absolute; top: 1rem; left: 1rem; background: rgba(16, 185, 129, 0.9); color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">Fresh</div>
                </div>
                <div style="padding: 1.5rem;">
                    <h3 style="font-size: 1.4rem; font-weight: 700; color: #333; margin-bottom: 0.5rem;">{{ dish.dish_name }}</h3>
                    <p style="color: #666; margin-bottom: 1.5rem; line-height: 1.5; font-size: 0.9rem;">{{ dish.description|default:"Fresh and crispy salad with premium ingredients and homemade dressing" }}</p>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <div style="flex: 1; text-align: center;">
                            <span style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 0.5rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Small</span>
                            <button type="button" class="salad-btn"
                                    onclick='addSaladToCart("Small Salad - {{ dish.dish_name }}", {{ dish.small_price }})'
                                    style="width: 100%; padding: 0.8rem 1.5rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
                                ${{ dish.small_price }}
                            </button>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <span style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 0.5rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Large</span>
                            <button type="button" class="salad-btn"
                                    onclick='addSaladToCart("Large Salad - {{ dish.dish_name }}", {{ dish.large_price }})'
                                    style="width: 100%; padding: 0.8rem 1.5rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                                ${{ dish.large_price }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <!-- Static salads (fallback) -->
            <div class="salad-card" style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); transition: all 0.3s ease;">
                <div class="salad-image" style="width: 100%; height: 200px; background: linear-gradient(45deg, #34d399 0%, #10b981 50%, #059669 100%); position: relative;">
                    <div style="position: absolute; top: 1rem; left: 1rem; background: rgba(16, 185, 129, 0.9); color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">Popular</div>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; opacity: 0.8;">ðŸ¥—</div>
                </div>
                <div style="padding: 1.5rem;">
                    <h3 style="font-size: 1.4rem; font-weight: 700; color: #333; margin-bottom: 0.5rem;">Caesar Salad</h3>
                    <p style="color: #666; margin-bottom: 1.5rem; line-height: 1.5;">Crisp romaine lettuce, parmesan cheese, croutons with classic Caesar dressing</p>
                    <div style="display: flex; gap: 1rem;">
                        <div style="flex: 1; text-align: center;">
                            <span style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 0.5rem; font-weight: 600;">Small</span>
                            <button type="button" class="salad-btn"
                                    onclick='addSaladToCart("Small Salad - Caesar Salad", 6.95)'
                                    style="width: 100%; padding: 0.8rem 1.5rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
                                $6.95
                            </button>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <span style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 0.5rem; font-weight: 600;">Large</span>
                            <button type="button" class="salad-btn"
                                    onclick='addSaladToCart("Large Salad - Caesar Salad", 9.95)'
                                    style="width: 100%; padding: 0.8rem 1.5rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                                $9.95
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="salad-card" style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); transition: all 0.3s ease;">
                <div class="salad-image" style="width: 100%; height: 200px; background: linear-gradient(45deg, #34d399 0%, #10b981 50%, #059669 100%); position: relative;">
                    <div style="position: absolute; top: 1rem; left: 1rem; background: rgba(16, 185, 129, 0.9); color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">Healthy</div>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; opacity: 0.8;">ðŸ¥—</div>
                </div>
                <div style="padding: 1.5rem;">
                    <h3 style="font-size: 1.4rem; font-weight: 700; color: #333; margin-bottom: 0.5rem;">Greek Salad</h3>
                    <p style="color: #666; margin-bottom: 1.5rem; line-height: 1.5;">Mixed greens, feta cheese, olives, tomatoes, cucumbers with Greek dressing</p>
                    <div style="display: flex; gap: 1rem;">
                        <div style="flex: 1; text-align: center;">
                            <span style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 0.5rem; font-weight: 600;">Small</span>
                            <button type="button" class="salad-btn"
                                    onclick='addSaladToCart("Small Salad - Greek Salad", 7.95)'
                                    style="width: 100%; padding: 0.8rem 1.5rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
                                $7.95
                            </button>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <span style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 0.5rem; font-weight: 600;">Large</span>
                            <button type="button" class="salad-btn"
                                    onclick='addSaladToCart("Large Salad - Greek Salad", 11.95)'
                                    style="width: 100%; padding: 0.8rem 1.5rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                                $11.95
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="salad-card" style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); transition: all 0.3s ease;">
                <div class="salad-image" style="width: 100%; height: 200px; background: linear-gradient(45deg, #34d399 0%, #10b981 50%, #059669 100%); position: relative;">
                    <div style="position: absolute; top: 1rem; left: 1rem; background: rgba(16, 185, 129, 0.9); color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">Garden Fresh</div>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; opacity: 0.8;">ðŸ¥—</div>
                </div>
                <div style="padding: 1.5rem;">
                    <h3 style="font-size: 1.4rem; font-weight: 700; color: #333; margin-bottom: 0.5rem;">Garden Salad</h3>
                    <p style="color: #666; margin-bottom: 1.5rem; line-height: 1.5;">Fresh mixed greens, tomatoes, carrots, cucumbers with your choice of dressing</p>
                    <div style="display: flex; gap: 1rem;">
                        <div style="flex: 1; text-align: center;">
                            <span style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 0.5rem; font-weight: 600;">Small</span>
                            <button type="button" class="salad-btn"
                                    onclick='addSaladToCart("Small Salad - Garden Salad", 5.95)'
                                    style="width: 100%; padding: 0.8rem 1.5rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
                                $5.95
                            </button>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <span style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 0.5rem; font-weight: 600;">Large</span>
                            <button type="button" class="salad-btn"
                                    onclick='addSaladToCart("Large Salad - Garden Salad", 8.95)'
                                    style="width: 100%; padding: 0.8rem 1.5rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                                $8.95
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Success Notification Toast -->
<div id="salad-toast" style="position: fixed; top: 120px; right: 20px; background: #10b981; color: white; padding: 1rem 1.5rem; border-radius: 12px; box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3); z-index: 10001; transform: translateX(100%); transition: transform 0.3s ease; display: flex; align-items: center; gap: 0.5rem;">
    <i class="fas fa-check-circle"></i>
    <span id="salad-message">Salad added to cart!</span>
</div>

<style>
/* Salad-specific styles */
.salad-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
}

.salad-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
}

.salad-btn:active {
    transform: translateY(0);
}

@media (max-width: 768px) {
    .salad-page { padding-top: 80px; }
    .hero h1 { font-size: 2rem; }
    .salad-grid { grid-template-columns: 1fr; padding: 0 1rem; }
    .container { padding: 2rem 1rem; }
    .salad-card > div:last-child > div:last-child { flex-direction: column; gap: 0.5rem; }
}
</style>

<script>
// Working Cart Functions for Salad (Following Pasta Pattern)
function addSaladToCart(description, price) {
    try {
        console.log('Adding salad to cart:', description, price);
        
        // Get existing cart
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        
        // Create cart item
        const cartItem = {
            item_description: description,
            price: parseFloat(price),
            image_url: "{% static 'orders/salad.jpg' %}",
            quantity: 1,
            category: 'salad'
        };
        
        // Check if item already exists
        const existingIndex = cart.findIndex(existing => 
            existing.item_description === cartItem.item_description
        );
        
        if (existingIndex !== -1) {
            // Update quantity if item exists
            cart[existingIndex].quantity = (cart[existingIndex].quantity || 1) + 1;
            showSaladNotification(`Quantity updated for ${description}!`);
        } else {
            // Add new item
            cart.push(cartItem);
            showSaladNotification(`${description} added to cart!`);
        }
        
        // Save cart and update count
        localStorage.setItem('cart', JSON.stringify(cart));
        updateSaladCartCount();
        
        // Visual feedback on button
        const clickedButton = event.target;
        const originalText = clickedButton.textContent;
        clickedButton.textContent = 'Added!';
        clickedButton.style.background = '#10ac84';
        
        setTimeout(() => {
            clickedButton.textContent = originalText;
            clickedButton.style.background = '';
        }, 1000);
        
        console.log('âœ… Salad successfully added to cart');
        
    } catch (error) {
        console.error('âŒ Error adding salad to cart:', error);
        showSaladNotification('Error adding salad to cart', 'error');
    }
}

function updateSaladCartCount() {
    try {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
        
        // Update all cart count elements
        const selectors = ['.cart-badge', '.cart-count', '#cart-count', '.mobile-cart-count'];
        selectors.forEach(selector => {
            const elements = document.querySelectorAll(selector);
            elements.forEach(element => {
                if (element) {
                    element.textContent = totalItems;
                    if (totalItems > 0) {
                        element.style.display = 'inline-flex';
                    } else {
                        element.style.display = 'none';
                    }
                }
            });
        });
        
        console.log(`Cart count updated: ${totalItems} items`);
    } catch (error) {
        console.error('Error updating cart count:', error);
    }
}

function showSaladNotification(message, type = 'success') {
    const toast = document.getElementById('salad-toast');
    const messageEl = document.getElementById('salad-message');
    
    if (toast && messageEl) {
        messageEl.textContent = message;
        
        // Set color based on type
        if (type === 'error') {
            toast.style.background = '#ef4444';
            toast.querySelector('i').className = 'fas fa-exclamation-circle';
        } else {
            toast.style.background = '#10b981';
            toast.querySelector('i').className = 'fas fa-check-circle';
        }
        
        // Show notification
        toast.style.transform = 'translateX(0)';
        
        // Hide after 3 seconds
        setTimeout(() => {
            toast.style.transform = 'translateX(100%)';
        }, 3000);
    }
}

// Initialize cart count on page load
document.addEventListener('DOMContentLoaded', function() {
    updateSaladCartCount();
    console.log('ðŸ¥— Salad page loaded with working cart functions');
});

// Update cart count on storage changes (for cross-tab updates)
window.addEventListener('storage', function(e) {
    if (e.key === 'cart') {
        updateSaladCartCount();
    }
});
</script>

<!-- Load your existing base.js for compatibility -->
<script src="{% static 'orders/js/base.js' %}"></script>

{% endblock %}